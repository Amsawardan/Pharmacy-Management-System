<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Medicine Management</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Floating label animation */
    .float-label {
      position: relative;
    }
    .float-label input,
    .float-label textarea {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #f1f1f1;
    }
    .float-label label {
      position: absolute;
      top: 50%;
      left: 0.75rem;
      transform: translateY(-50%);
      transition: all 0.2s ease;
      color: #bbb;
      pointer-events: none;
      font-size: 0.9rem;
    }
    .float-label input:focus + label,
    .float-label input:not(:placeholder-shown) + label,
    .float-label textarea:focus + label,
    .float-label textarea:not(:placeholder-shown) + label {
      top: -0.5rem;
      left: 0.5rem;
      font-size: 0.75rem;
      color: #ffc107; /* yellow highlight */
      background: #1e1f22;
      padding: 0 4px;
      border-radius: 4px;
    }
  </style>
</head>
<body class="bg-[#1e1f22] font-sans text-white min-h-screen flex justify-center items-start py-10">

<div class="w-full max-w-5xl bg-[#2a2b2e] rounded-2xl p-8 shadow-2xl border border-gray-700">
  <h1 class="text-3xl font-bold text-center text-[#ffc107] mb-8 animate-fadeIn">Raj Pharmacy - Medicine Management</h1>

  <!-- Add Medicine -->
  <h2 class="text-2xl font-semibold text-[#ffc107] mb-6">Add Medicine</h2>
  <form id="medicineForm" class="grid grid-cols-2 gap-6">
    <div class="float-label">
      <input type="text" id="name" placeholder=" " required class="w-full rounded-lg px-3 py-2" />
      <label for="name">Name</label>
    </div>
    <div class="float-label">
      <input type="text" id="category" placeholder=" " required class="w-full rounded-lg px-3 py-2" />
      <label for="category">Category</label>
    </div>
    <div class="float-label">
      <input type="text" id="batchNo" placeholder=" " required class="w-full rounded-lg px-3 py-2" />
      <label for="batchNo">Batch No</label>
    </div>
    <div class="float-label">
      <input type="number" id="stock" placeholder=" " required class="w-full rounded-lg px-3 py-2" />
      <label for="stock">Stock</label>
    </div>
    <div class="float-label">
      <input type="number" step="0.01" id="price" placeholder=" " required class="w-full rounded-lg px-3 py-2" />
      <label for="price">Price</label>
    </div>
    <div class="float-label">
      <input type="date" id="expiryDate" placeholder=" " required class="w-full rounded-lg px-3 py-2" />
      <label for="expiryDate">Expiry Date</label>
    </div>
    <div class="float-label">
      <input type="number" id="supplierId" placeholder=" " required class="w-full rounded-lg px-3 py-2" />
      <label for="supplierId">Supplier ID</label>
    </div>
    <div class="col-span-2 float-label">
      <textarea id="description" placeholder=" " class="w-full rounded-lg px-3 py-2"></textarea>
      <label for="description">Description</label>
    </div>
    <div class="col-span-2 float-label">
      <textarea id="dosageInstructions" placeholder=" " class="w-full rounded-lg px-3 py-2"></textarea>
      <label for="dosageInstructions">Dosage Instructions</label>
    </div>
    <div class="col-span-2 float-label">
      <textarea id="sideEffects" placeholder=" " class="w-full rounded-lg px-3 py-2"></textarea>
      <label for="sideEffects">Side Effects</label>
    </div>
    <button type="submit" class="col-span-2 bg-[#ffc107] text-black font-bold py-3 rounded-lg shadow hover:shadow-lg hover:scale-105 transform transition">Add Medicine</button>
  </form>

  <!-- Alerts -->
  <h2 class="text-2xl font-semibold text-[#ffc107] mt-10 mb-4">Alerts</h2>
  <div id="lowStockAlert" class="bg-yellow-900/40 border border-yellow-600 rounded p-4 mb-4">
    <h3 class="font-bold text-yellow-400">Low Stock Medicines</h3>
    <ul id="lowStockList" class="list-disc pl-6"></ul>
  </div>
  <div id="expiredAlert" class="bg-red-900/40 border border-red-600 rounded p-4 mb-6">
    <h3 class="font-bold text-red-400">Expired Medicines</h3>
    <ul id="expiredList" class="list-disc pl-6"></ul>
  </div>

  <!-- Medicine List -->
  <h2 class="text-2xl font-semibold text-[#ffc107] mb-4">All Medicines</h2>
  <ul id="medicineList" class="space-y-3"></ul>

  <!-- Get Medicine By ID -->
  <h2 class="text-2xl font-semibold text-[#ffc107] mt-10 mb-4">Find Medicine by ID</h2>
  <div class="flex space-x-3 mb-6">
    <input type="number" id="medicineIdInput" placeholder="Enter ID" class="w-40 px-3 py-2 rounded-lg bg-gray-800 border border-gray-600 text-white" />
    <button onclick="getMedicineById()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg transition">Search</button>
  </div>
  <div id="medicineByIdResult" class="p-4 bg-gray-800 border border-gray-700 rounded"></div>
</div>

<!-- Update Modal -->
<div id="updateModal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50">
  <div class="bg-[#2a2b2e] p-6 rounded-xl shadow-xl w-[500px] border border-gray-600">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold text-[#ffc107]">Update Medicine</h2>
      <span class="close cursor-pointer text-red-500 text-2xl">&times;</span>
    </div>
    <form id="updateForm" class="grid grid-cols-2 gap-4">
      <input type="hidden" id="updateId" />
      <div class="float-label"><input type="text" id="updateName" placeholder=" " required class="w-full px-2 py-1 rounded" /><label for="updateName">Name</label></div>
      <div class="float-label"><input type="text" id="updateCategory" placeholder=" " required class="w-full px-2 py-1 rounded" /><label for="updateCategory">Category</label></div>
      <div class="float-label"><input type="text" id="updateBatchNo" placeholder=" " required class="w-full px-2 py-1 rounded" /><label for="updateBatchNo">Batch No</label></div>
      <div class="float-label"><input type="number" id="updateStock" placeholder=" " required class="w-full px-2 py-1 rounded" /><label for="updateStock">Stock</label></div>
      <div class="float-label"><input type="number" step="0.01" id="updatePrice" placeholder=" " required class="w-full px-2 py-1 rounded" /><label for="updatePrice">Price</label></div>
      <div class="float-label"><input type="date" id="updateExpiryDate" placeholder=" " required class="w-full px-2 py-1 rounded" /><label for="updateExpiryDate">Expiry Date</label></div>
      <div class="float-label"><input type="number" id="updateSupplierId" placeholder=" " required class="w-full px-2 py-1 rounded" /><label for="updateSupplierId">Supplier ID</label></div>
      <div class="col-span-2 float-label"><textarea id="updateDescription" placeholder=" " class="w-full px-2 py-1 rounded"></textarea><label for="updateDescription">Description</label></div>
      <div class="col-span-2 float-label"><textarea id="updateDosageInstructions" placeholder=" " class="w-full px-2 py-1 rounded"></textarea><label for="updateDosageInstructions">Dosage Instructions</label></div>
      <div class="col-span-2 float-label"><textarea id="updateSideEffects" placeholder=" " class="w-full px-2 py-1 rounded"></textarea><label for="updateSideEffects">Side Effects</label></div>
      <button type="submit" class="col-span-2 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition">Update Medicine</button>
    </form>
  </div>
</div>

<!-- Integrated JS -->
<script>
  const API_URL = "http://localhost:8081/api/medicines";

  // Init
  document.addEventListener("DOMContentLoaded", async () => {
    await loadMedicines();
    await loadLowStockMedicines();
    await loadExpiredMedicines();
  });

  // Add Medicine
  document.getElementById("medicineForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const medicine = {
      name: document.getElementById("name").value,
      category: document.getElementById("category").value,
      batchNo: document.getElementById("batchNo").value,
      stock: parseInt(document.getElementById("stock").value),
      price: parseFloat(document.getElementById("price").value),
      expiryDate: document.getElementById("expiryDate").value,
      supplierId: parseInt(document.getElementById("supplierId").value),
      description: document.getElementById("description").value,
      dosageInstructions: document.getElementById("dosageInstructions").value,
      sideEffects: document.getElementById("sideEffects").value,
    };

    await fetch(`${API_URL}/add`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(medicine)
    });

    alert("Medicine Added!");
    document.getElementById("medicineForm").reset();
    await reloadAll();
  });

  // Load All Medicines
  async function loadMedicines() {
    const res = await fetch(`${API_URL}/list`);
    const medicines = await res.json();
    const list = document.getElementById("medicineList");
    list.innerHTML = "";
    medicines.forEach((med) => {
      const li = document.createElement("li");
      li.innerHTML = `
      <div>
        <strong>${med.name}</strong> (${med.category}) - Stock: ${med.stock}, Price: ${med.price}, Expiry: ${med.expiryDate}
      </div>
      <div class="actions">
        <button class="update-btn bg-blue-600 text-white px-2 py-1 rounded mr-2" onclick="openUpdateModal(${med.id})">Update</button>
        <button class="delete-btn bg-red-600 text-white px-2 py-1 rounded" onclick="deleteMedicine(${med.id})">Delete</button>
      </div>
    `;
      list.appendChild(li);
    });
  }

  // Load Low Stock
  async function loadLowStockMedicines() {
    const res = await fetch(`${API_URL}/low-stock`);
    const lowStock = await res.json();
    const list = document.getElementById("lowStockList");
    list.innerHTML = "";
    lowStock.forEach((med) => {
      const li = document.createElement("li");
      li.innerHTML = `<span style="color:red; font-weight:bold;">⚠️ ${med.name}</span> - Stock: ${med.stock}`;
      list.appendChild(li);
    });
  }

  // Load Expired
  async function loadExpiredMedicines() {
    const res = await fetch(`${API_URL}/expired`);
    const expired = await res.json();
    const list = document.getElementById("expiredList");
    list.innerHTML = "";
    expired.forEach((med) => {
      const li = document.createElement("li");
      li.innerHTML = `<span style="color:darkred; font-weight:bold;">⏰ ${med.name}</span> - Expired: ${med.expiryDate}`;
      list.appendChild(li);
    });
  }

  // Delete
  async function deleteMedicine(id) {
    if (confirm("Are you sure?")) {
      await fetch(`${API_URL}/delete/${id}`, { method: "DELETE" });
      await reloadAll();
    }
  }

  // Open Update Modal
  async function openUpdateModal(id) {
    const res = await fetch(`${API_URL}/${id}`);
    const med = await res.json();

    // fill modal form
    document.getElementById("updateId").value = med.id;
    document.getElementById("updateName").value = med.name;
    document.getElementById("updateCategory").value = med.category;
    document.getElementById("updateBatchNo").value = med.batchNo;
    document.getElementById("updateStock").value = med.stock;
    document.getElementById("updatePrice").value = med.price;
    document.getElementById("updateExpiryDate").value = med.expiryDate;
    document.getElementById("updateSupplierId").value = med.supplierId;
    document.getElementById("updateDescription").value = med.description || "";
    document.getElementById("updateDosageInstructions").value = med.dosageInstructions || "";
    document.getElementById("updateSideEffects").value = med.sideEffects || "";

    document.getElementById("updateModal").style.display = "flex";
  }

  //  Submit Update Form
  document.getElementById("updateForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const id = document.getElementById("updateId").value;
    const medicine = {
      name: document.getElementById("updateName").value,
      category: document.getElementById("updateCategory").value,
      batchNo: document.getElementById("updateBatchNo").value,
      stock: parseInt(document.getElementById("updateStock").value),
      price: parseFloat(document.getElementById("updatePrice").value),
      expiryDate: document.getElementById("updateExpiryDate").value,
      supplierId: parseInt(document.getElementById("updateSupplierId").value),
      description: document.getElementById("updateDescription").value,
      dosageInstructions: document.getElementById("updateDosageInstructions").value,
      sideEffects: document.getElementById("updateSideEffects").value,
    };

    await fetch(`${API_URL}/update/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(medicine)
    });

    alert("Medicine updated!");
    document.getElementById("updateModal").style.display = "none";
    await reloadAll();
  });

  // Close modal
  document.querySelector(".close").addEventListener("click", () => {
    document.getElementById("updateModal").style.display = "none";
  });

  // Get Medicine by ID
  async function getMedicineById() {
    const id = document.getElementById("medicineIdInput").value;
    if (!id) return alert("Enter ID");
    const res = await fetch(`${API_URL}/${id}`);
    if (res.status === 404) {
      document.getElementById("medicineByIdResult").textContent = "Medicine not found";
    } else {
      const med = await res.json();
      document.getElementById("medicineByIdResult").textContent = `${med.name} (${med.category}) - Stock: ${med.stock}, Price: ${med.price}, Expiry: ${med.expiryDate}`;
    }
  }

  // Reload all lists
  async function reloadAll() {
    await loadMedicines();
    await loadLowStockMedicines();
    await loadExpiredMedicines();
  }
</script>
</body>
</html>
