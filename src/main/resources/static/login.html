<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Raj Pharmacy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
    <style>
        :root {
          --primary: #2b6cb0;
          --secondary: #48bb78;
          --text-dark: #2d3748;
          --text-light: #edf2f7;
          --bg-light: #f7fafc;
        }
        body {
          background: var(--bg-light);
          font-family: 'Poppins', sans-serif;
          display: flex;
          justify-content: center;
          align-items: center;
          min-height: 100vh;
          margin: 0;
        }
        .container-box {
          width: 90%;
          max-width: 950px;
          display: flex;
          border-radius: 1rem;
          overflow: hidden;
          box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
          background: white;
        }
        .left {
          position: relative;
          flex: 1;
          background: url('https://cdn-icons-png.flaticon.com/512/4320/4320371.png') center/180px no-repeat,
                      linear-gradient(135deg, #2b6cb0 0%, #48bb78 100%);
          color: var(--text-light);
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          text-align: center;
          padding: 3rem 2rem;
        }
        .overlay {
          position: absolute;
          top: 0; left: 0; right: 0; bottom: 0;
          background: rgba(0, 0, 0, 0.4);
          z-index: 1;
        }
        .overlay-content {
          position: relative;
          z-index: 2;
        }
        .overlay-content h1 {
          font-size: 2rem;
          font-weight: 700;
          color: #ffffff;
          margin-bottom: 1rem;
        }
        .overlay-content p {
          font-size: 1.1rem;
          color: #e2e8f0;
          max-width: 320px;
          margin: 0 auto;
        }
        .right {
          flex: 1;
          padding: 3rem 2rem;
          background: #ffffff;
          display: flex;
          flex-direction: column;
          justify-content: center;
        }
        h2 {
          font-weight: 600;
          color: var(--primary);
          margin-bottom: 1.5rem;
          text-align: center;
        }
        .form-control {
          border-radius: 0.5rem;
          padding: 0.75rem;
        }
        .btn-primary {
          background: var(--primary);
          border: none;
          padding: 0.75rem;
          border-radius: 0.5rem;
          transition: 0.2s;
        }
        .btn-primary:hover {
          background: #1e4e8c;
          transform: translateY(-1px);
        }
        .error-message {
          background: rgba(255, 0, 0, 0.08);
          color: #c53030;
          padding: 10px;
          border-radius: 8px;
          display: none;
          font-size: 0.9rem;
          margin-top: 10px;
        }
        .success-message {
          background: rgba(72, 187, 120, 0.1);
          color: #2f855a;
          padding: 10px;
          border-radius: 8px;
          display: none;
          font-size: 0.9rem;
          margin-top: 10px;
        }
        .tab-links {
          display: flex;
          justify-content: space-around;
          margin-bottom: 20px;
        }
        .tab-links button {
          border: none;
          background: none;
          font-weight: 600;
          color: var(--primary);
          cursor: pointer;
          padding: 5px 10px;
        }
        .tab-links button.active {
          border-bottom: 2px solid var(--primary);
        }
        @media (max-width: 768px) {
          .container-box {
            flex-direction: column;
          }
          .left {
            background-size: 120px;
            padding: 2rem;
          }
        }
    </style>
</head>
<body>
<div class="container-box">
    <div class="left">
        <div class="overlay"></div>
        <div class="overlay-content">
            <h1>Welcome to Raj Pharmacy</h1>
            <p>Your trusted digital platform for secure prescriptions and user management.</p>
        </div>
    </div>

    <div class="right">
        <div class="tab-links">
            <button class="active" id="userTab">User</button>
            <button id="adminTab">Admin</button>
        </div>

        <!-- USER LOGIN/SIGNUP -->
        <div id="userSection">
            <div id="loginForm">
                <h2>Sign In</h2>
                <form id="login">
                    <div class="mb-3">
                        <label>Email</label>
                        <input type="email" id="loginEmail" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label>Password</label>
                        <input type="password" id="loginPassword" class="form-control" required />
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Login</button>
                    <div id="loginError" class="error-message"></div>
                </form>
                <p class="mt-3 text-center">
                    Don't have an account?
                    <a href="#" id="switchToSignup">Sign up</a>
                </p>
            </div>

            <div id="signupForm" style="display: none">
                <h2>Create Account</h2>
                <form id="signup">
                    <div class="mb-3">
                        <label>Full Name</label>
                        <input type="text" id="signupName" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label>Email</label>
                        <input type="email" id="signupEmail" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label>Password</label>
                        <input type="password" id="signupPassword" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label>Address</label>
                        <input type="text" id="signupAddress" class="form-control" required />
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Sign Up</button>
                    <div id="signupError" class="error-message"></div>
                    <div id="signupSuccess" class="success-message"></div>
                </form>
                <p class="mt-3 text-center">
                    Already have an account?
                    <a href="#" id="switchToLogin">Sign in</a>
                </p>
            </div>
        </div>

        <!-- ADMIN LOGIN -->
        <div id="adminSection" style="display:none;">
            <h2>Admin Login</h2>
            <form id="adminLogin">
                <div class="mb-3">
                    <label>Email</label>
                    <input type="email" id="adminEmail" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>Password</label>
                    <input type="password" id="adminPassword" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">Login</button>
                <div id="adminError" class="error-message"></div>
            </form>
        </div>
    </div>
</div>

<script>
    const USER_API_BASE = "http://localhost:8082/user";
    const ADMIN_API_BASE = "http://localhost:8082/admin";

    // TAB SWITCHING
    const userTab = document.getElementById("userTab");
    const adminTab = document.getElementById("adminTab");
    const userSection = document.getElementById("userSection");
    const adminSection = document.getElementById("adminSection");

    userTab.onclick = () => {
        userTab.classList.add("active");
        adminTab.classList.remove("active");
        userSection.style.display = "block";
        adminSection.style.display = "none";
    };
    adminTab.onclick = () => {
        adminTab.classList.add("active");
        userTab.classList.remove("active");
        userSection.style.display = "none";
        adminSection.style.display = "block";
    };

    // USER LOGIN/SIGNUP SWITCH
    const loginForm = document.getElementById("loginForm");
    const signupForm = document.getElementById("signupForm");
    document.getElementById("switchToSignup").onclick = e => { e.preventDefault(); loginForm.style.display="none"; signupForm.style.display="block"; };
    document.getElementById("switchToLogin").onclick = e => { e.preventDefault(); signupForm.style.display="none"; loginForm.style.display="block"; };

    // SIGNUP
    document.getElementById("signup").onsubmit = async e => {
        e.preventDefault();
        const user = {
            name: document.getElementById("signupName").value.trim(),
            email: document.getElementById("signupEmail").value.trim(),
            password: document.getElementById("signupPassword").value,
            address: document.getElementById("signupAddress").value.trim(),
        };
        const errorBox = document.getElementById("signupError");
        const successBox = document.getElementById("signupSuccess");
        errorBox.style.display = "none"; successBox.style.display="none";

        if(!user.name || !user.email || !user.password || !user.address){
            errorBox.textContent="Please fill all fields!";
            errorBox.style.display="block";
            return;
        }

        try {
            const res = await fetch(USER_API_BASE, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(user)
            });
            if(res.ok){
                successBox.textContent="Signup successful! Please log in now.";
                successBox.style.display="block";
                document.getElementById("signup").reset();
                setTimeout(() => { signupForm.style.display="none"; loginForm.style.display="block"; }, 2000);
            } else {
                const msg = await res.text();
                errorBox.textContent= msg || "Signup failed";
                errorBox.style.display="block";
            }
        } catch(err){ errorBox.textContent="Network error"; errorBox.style.display="block"; }
    };

    // USER LOGIN
    document.getElementById("login").onsubmit = async e => {
        e.preventDefault();
        const email = document.getElementById("loginEmail").value.trim();
        const password = document.getElementById("loginPassword").value;
        const errorBox = document.getElementById("loginError"); errorBox.style.display="none";

        try {
            const res = await fetch(USER_API_BASE);
            if(!res.ok) throw new Error("Failed to fetch users");
            const users = await res.json();
            const user = users.find(u => u.email===email && u.password===password);
            if(!user){ errorBox.textContent="Invalid email or password"; errorBox.style.display="block"; return; }
            localStorage.setItem("loggedInUser", JSON.stringify(user));
            window.location.href="http://localhost:8082/home.html";
        } catch(err){ errorBox.textContent="Error logging in"; errorBox.style.display="block"; }
    };

    // ADMIN LOGIN
    document.getElementById("adminLogin").onsubmit = async e => {
        e.preventDefault();
        const email = document.getElementById("adminEmail").value.trim();
        const password = document.getElementById("adminPassword").value;
        const errorBox = document.getElementById("adminError"); errorBox.style.display="none";

        try {
            const res = await fetch(`${ADMIN_API_BASE}/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password })
            });

            if(res.status===403){
                errorBox.textContent="Invalid email or password";
                errorBox.style.display="block";
                return;
            }
            if(!res.ok) throw new Error("Error logging in");

            const admin = await res.json();
            localStorage.setItem("loggedInUser", JSON.stringify(admin));
            // Updated redirect URL for admin
            window.location.href="http://localhost:8081/inventory";

        } catch(err){ errorBox.textContent="Error logging in"; errorBox.style.display="block"; }
    };
</script>
</body>
</html>
